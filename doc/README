_______________________ FreeNAC README _____________________________

This is Version 2.1 RC3 of FreeNAC, Release  2007.01.26

To install please see master_server_install.txt and master_server_config.txt

Check our website http://www.freenac.net for news about our project



Upgrade from RC2 to RC3

To check the list of changes in your system without actually changing anything, do:

svn status -u

__________________________Changes from RC2 to RC3______________________________________

*** Configuration files

etc/config.inc.template:
         		** It is VERY important that you update and verify config.inc
         		from the template when updating to newer releases.***
         
         New variables: 
	$default_user_unknown, set_status_for_unknowns, $snmp_ro/rw, $send_mail_if_updates
         Important: 	
	Changed format of $set_vlan_for_unknowns from "vlan=0," to "0".
         Clean old legacy infnet stuff. 
	Add enterprise include.
         correct router_mac_ip_ignore_ip, add entries for adsync
etc/port_scan.inc.template:	Added option -n to command line (avoids using DNS)

*** DB schema
It is VERY important that you update the DB
contrib/2.1_rc2_to_rc3.txt	SQL statements to update the DB


*** Scripts

bin/restart_port:			Fix for Cisco 2960 IOS
bin/vmps_lastseen:		Added $set_status_for_unknowns and changed format of 
				$set_vlan_for_unknowns from vlan=0 to 0.
				This last change is really important, so please make sure you have changed this.
bin/vmpsd_external:		Logging
bin/rad2vmps			Includes physical port interface in the VMPS request (Cisco only)
bin/router_mac_ip: 		Hostnames lowercase, Delete von_user
bin/ad_user_sync: 		mysql_real_escape_string
bin/updates: 			Informs systems admin if updates are available
all scripts			Removed absolute paths to include files

*** Other files

contrib/profile.local 		For a more confortable environment
contrib/freeradius/etc/raddb/radiusd.conf.certificates|winlogon|winlogon+macauthbypass:  Several examples of how to configure FreeRadius
contrib/etc_php5_cli/php.ini: 	PHP ini file
doc/master_server_install.txt: 	sys_class2 rights, PHP compile for SNMP & 5.2.0, split
doc/master_server_config.txt	Configuration of a NAC system
doc/Radius-install.txt 
contrib/kerberos
contrib/samba: added   
doc/FreeNAC_RC2_VM_howto.txt   


*** GUIs

web2: 				An enhanced web2 GUI shows some more information, allows searching by VLAN, 
     				switch and username as well as an export to Excel (requires a PEAR module, 
     				see README.web2 for details).  
Windows GUI:			See README.wingui.txt for details  


*** Tools

mytop				Please include it as part of your RC3 instalation. Should be in your Linux distro
expect				Please include it as part of your RC3 instalation. Should be in your Linux distro
FreeRadius 1.1.4		This new version includes support for Windows Vista



__________________________________Upgrading RC2 to RC3____________________________________

svn update

Make a copy of your etc/config.inc file and create a new config.inc from config.inc.template and adjust the variables you need

In the etc/port_scan.inc file, add "-n" to the $nmap_flags var.

"mysql inventory" and copy and paste the statements contained in contrib/2.1_rc2_to_rc3.txt

Add contrib/profile.local at the end of /etc/profile.local

Verify the new crontab entries
[Sample crontab]
* * * * *              	/opt/nac/bin/cron_restart_port
*/5 8-18 * * 1-5       	/opt/nac/bin/port_scan --scannow
*/6 * * * *            	/opt/nac/bin/router_mac_ip
0 1 * * 1              	/opt/nac/bin/purge_unknowns

# Active scanning: nmap monday
0 11 * * 1             	/opt/nac/bin/port_scan
 
# Log pruning
0 6 * * 1-5           	/usr/sbin/logrotate /etc/logrotate.conf | logger
#0 8,12  * * 1-5       	/opt/nac/logcheck/logcheck.sh
0   1   26 * *         	/opt/nac/bin/purge_unknowns
 
# Mysql Master: Clean mysql logs on the 1st per month
0 6 30  * 1     		/usr/local/mysql/bin/mysql -uroot -e "PURGE MASTER LOGS BEFORE DATE_SUB( NOW( ), INTERVAL 30 DAY);"
 
## Monitoring:
## [Note: the proctst daemon is the main method of daemon watching]
#*/20 7-18 * * 1-5 	/opt/nac/bin/monitor_processes.pl proctst vmpsd_external winbindd smbd nmbd radiusd
#*/20 7-18 * * 1-5 	/opt/nac/bin/monitor_processes.pl proctst vmpsd_external #30   6-22 * * 1-5 /opt/nac/bin/monitor_allows.sh
*/4 * * * *   		/opt/nac/bin/flap_detect
2 7-18 * * 1-5 		/opt/nac/bin/check_mysql
*/3 * * * *    		/opt/nac/bin/check_disk 90 800
  
# Backups
0 1 * * 1          		/opt/nac/bin/dump_ports
#0 3 * * 1-5       		/usr/local/mysql/bin/mysqlhotcopy --allowold --keepold --regexp=".+" /disk2/backups/mysql 2>&1 | logger
#0 2 * * 3,6       		/opt/nac/contrib/rdiff.run / /disk2/backups/vmps1.rdiff|logger; /opt/nac/contrib/rdiff.run svmps2::/ /disk2/backups/vmps2.rdiff|logger

# Notify if there are updates
0 0 * * 0		/opt/nac/bin/updates

For the web GUIs, we have added user authentication in the domain controller, so instructions on how to perform this are in doc/webADauth.txt

Windows Vista seems to be doing PEAP differently, so you need to download FreeRadius 1.1.4 (http://freeradius.org/getting.html) and build it as usual. The aim of this release is Vista support.

Install mytop and expect. They should come with your distro's CDs or if running the previous VM do "yast -i expect mytop"
